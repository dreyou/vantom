<html>
<head>
  <link rel="stylesheet" href="css/bootstrap.min.css"/>
  <link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
  <script src="js/jquery.min.js"></script>
  <script src="js/json2.js"></script>
  <script src="js/jolokia-min.js"></script>
  <script src="js/jolokia-simple-min.js"></script>
  <!-- Google Charts -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>
//Constansts here
var MAX_POINTS = 128;
var INTERVAL = 1;
var RIGHT_SHIFT = 4;
//Globals here
var charts = [];
var update;
var j4p = [];
var hostsData = [];
var skip = false;
//Inits here
google.charts.load('current', {packages: ['corechart']});
 google.charts.setOnLoadCallback(function(){
   for( key in initHostArray()){
     charts[key] =  new google.visualization.LineChart(document.getElementById(key));
   }
   updateData();
 });
//JOLOKIA_HOSTS_TEMPLATES
//###
j4p[1] = new Jolokia("http://localhost:8081/jolokia");
j4p[2] = new Jolokia("http://localhost:8082/jolokia");
j4p[3] = new Jolokia("http://localhost:8083/jolokia");
//###
function initHostArray(){
  var jmx = [];
  jmx["HeapMemoryUsage"] = ({data: [], divider: 1000000, type: "Memory", name: "HeapMemoryUsage", subName: "used"});
  jmx["NonHeapMemoryUsage"] = ({data: [], divider: 1000000, type: "Memory", name: "NonHeapMemoryUsage", subName: "used"});
  jmx["SystemLoadAverage"] = ({data: [], divider: 1, type: "OperatingSystem", name: "SystemLoadAverage", subName: ""});
  jmx["ThreadCount"] = ({data: [], divider: 1, type: "Threading", name: "ThreadCount", subName: ""});
  return jmx;
}
function init(){
  for(var i=1;i<j4p.length;i++){
      hostsData[i]=initHostArray();
  }
  update = setInterval(function(){updateData();},1000*INTERVAL);
}
function updateData(){
  if(skip)return;
  for(var i=1;i<j4p.length;i++){
    for(var key in hostsData[i]){
      var value = j4p[i].getAttribute("java.lang:type="+hostsData[i][key].type,hostsData[i][key].name,hostsData[i][key].subName);
      if(hostsData[i][key].data.length >= MAX_POINTS){
        hostsData[i][key].data.shift();
      }
      hostsData[i][key].data.push(Number(value)); 
    }
  }
  for( key in initHostArray()){
    var currentData = new google.visualization.DataTable();
    for(var a=0;a<j4p.length;a++){
      if(a==0){
        currentData.addColumn("number");
      }else{
        currentData.addColumn("number","s"+a);
      }
    }
    for(var j=0;j<hostsData[1][key].data.length;j++){
      var addRowArr = [];
      addRowArr.push(Number(j));
      for(var i=1;i<j4p.length;i++){
        addRowArr.push(hostsData[i][key].data[j]);
      }
      currentData.addRow(addRowArr);
    }
    charts[key].draw(currentData,({'title': key, hAxis: { maxValue: MAX_POINTS+RIGHT_SHIFT, minValue: 0 }, vAxis: { viewWindow: {min: 0 } },}));
  }
}
function stopClicked(){
  skip = $('#stop').is(":checked"); 
}
</script>
</head>
<body onLoad="init();">
<div align="center">
<form>
Stop <input id="stop" type="checkbox" onClick="stopClicked();"></input>
</form>
</div>
<div>
<div id="HeapMemoryUsage" style="float:left;width:50%;height:400;"></div>
<div id="NonHeapMemoryUsage" style="float:left;width:50%;height:400;"></div>
</div>
<div>
<div id="ThreadCount" style="float:left;width:50%;height:400;"></div>
<div id="SystemLoadAverage" style="float:left;width:50%;height:400;"></div>
</div>
</body>
</html>
